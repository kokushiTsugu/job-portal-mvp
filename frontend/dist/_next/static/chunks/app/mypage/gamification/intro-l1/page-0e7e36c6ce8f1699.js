(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[713],{7790:()=>{},4148:(e,t,a)=>{Promise.resolve().then(a.bind(a,8951))},8951:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>i});var s=a(5155),r=a(2115),o=a(6046),n=a(3229);function i(){(0,o.useRouter)();let[e,t]=(0,r.useState)(""),[a,i]=(0,r.useState)(""),c=async()=>{t("");try{let e=localStorage.getItem("token");if(!e)throw Error("ログインが必要です。");if(!window.ethereum)throw Error("MetaMaskが見つかりません。");let a=new n.j(window.ethereum);await a.send("eth_requestAccounts",[]);let s=a.getSigner(),r=await s.getAddress();i(r);let o=await fetch("http://localhost:8080/web3/request-challenge",{headers:{Authorization:"Bearer ".concat(e)}});if(!o.ok){let e=await o.json();throw Error(e.message||"チャレンジ取得失敗")}let{challenge:c}=await o.json(),l=await s.signMessage(c),h=await fetch("http://localhost:8080/web3/verify",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify({address:r,signature:l})}),d=await h.json();if(!h.ok)throw Error(d.message||"verifyエラー");t("成功: ".concat(d.message,"\nレベル:").concat(d.onChainLevel,"\n完了タスク:").concat(d.completedTasks.join(", ")))}catch(e){t("エラー: ".concat(e.message))}};return(0,s.jsxs)("div",{className:"bg-white p-6 rounded shadow",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"初級タスク: ウォレット接続 (一気に署名)"}),e&&(0,s.jsx)("p",{className:"mb-4 whitespace-pre-line",children:e}),a&&(0,s.jsxs)("p",{className:"mb-4 text-sm",children:["あなたのウォレットアドレス: ",a]}),(0,s.jsx)("button",{onClick:c,className:"bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded",children:"メタマスクを連携して署名"})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[186,441,517,358],()=>t(4148)),_N_E=e.O()}]);